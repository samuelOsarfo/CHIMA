---
title: "CHIMA"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{CHIMA}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Introduction

The `CHIMA` package performs high-dimensional mediator screening and testing in the presence of high correlation among mediators using Ridge-HOLP and Approximate Orthogonalization methods. In addition to accounting for correlation, the method is designed to detect mediators that exhibit joint effects. This vignette demonstrates how to use the primary functions with a simulated dataset, `ExampleData`.



# Summary of Functions

## `medsc_holp`

- **Description**: Performs mediator screening using the Ridge-HOLP method.
- **Usage**: `medsc_holp(y, x, M, d = NULL, r = 1)`
- **Arguments**:
  - `y`: Outcome vector.
  - `x`: Exposure vector.
  - `M`: Matrix of mediators.
  - `COV.S`:  a `data.frame` or  `matrix` of covariates (optional).
  - `d`: Desired number of mediators to select (optional). Default value is $d= n/\log(n)$.
  - `r`: Ridge-HOLP penalty parameter (default is 1).

## `app_orth`

- **Description**: Fits the Approximate Orthogonalization model to test the significance of mediators.
- **Usage**:  
  `app_orth(y, x, chosen_M, COV.S=NULL, k = 1)`  
- **Arguments**:
  - `y`: Outcome vector.
  - `x`: Exposure vector.
  - `chosen_M`: Matrix of mediators selected during screening.
  - `COV.S`:  a `data.frame` or  `matrix` of covariates (optional).
  - `k`: Scalar used to compute projection directions (default is 1).


## `get_active_med`

- **Description**: This is wrapper function that combine screening and testing to identify active mediators.
- **Usage**:  
  `get_active_med(y, x, M, COV.S=NULL, pval.adjust='HDMT', d=NULL, r=1, k=1)`  

- **Arguments**:
  - `y`: Outcome vector.
  - `x`: Exposure vector.
  - `M`: Matrix of mediators.
  - `COV.S`: A `data.frame` or `matrix` of covariates (optional).
  - `pval.adjust`: Specifies which method to use for controlling FWER or FDR in the joint significance testing. Either `HDMT` (default) or `Bonferroni`.
  - `d`: Desired number of mediators to select (optional). Default is $d = n / \log(n)$.
  - `r`: Ridge penalty for HOLP (default = 1).
  - `k`: Scalar for computing projection directions for AO (default = 1).

```{r}
# Load the ExampleData
library(CHIMA)
data(ExampleData)

# Extract the components
y <- ExampleData$y
x <- ExampleData$x
M <- ExampleData$M
```

# Mediator Screening using Ridge-HOLP

```{r}
# Perform Ridge-HOLP screening
chosen_ind <- medsc_holp(y, x, M)

print("Indexes of selected mediators:")
print(chosen_ind)
```

# Fitting Approximate Orthogonalization (AO)

```{r}
# Apply AO on the chosen mediators
chosen_med <- M[, medsc_holp(y, x, M)]
ao_result <- app_orth(y, x, chosen_med)

print("beta_j's estimates for selected mediators:")
print(ao_result$bhat)

print("Test statistics for selected mediators:")
print(ao_result$ts)

print("P-values for selected mediators:")
print(ao_result$pval)



```


# Identifying Active Mediators

```{r}
# Using HDMT For FDR control
active_mediators<- get_active_med(y, x, M)
print(active_mediators)

```



# Reference

- Wang, X., & Leng, C. (2016). High dimensional ordinary least squares projection for screening variables. *Journal of the Royal Statistical Society Series B: Statistical Methodology*, 78(3), 589–611.
- Battey, H. S., & Reid, N. (2023). On inference in high-dimensional regression. *Journal of the Royal Statistical Society Series B: Statistical Methodology*, 85(1), 149–175.
